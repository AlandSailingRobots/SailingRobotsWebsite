(function(){var missionName="",missionDescription="",missionLastUse="",id_mission=0;if(listOfPoints.childElementCount==0){listOfPoints.parentNode.style.display="none"}document.getElementById('myConfig').style.display='none';$('#missionSelection').on('change',function(){id_mission=$(this).children(':selected').attr('id');handleMissionSelection(id_mission)});getMissionListFromDB(0);function getMissionListFromDB(id){$.ajax({type:'POST',url:'php/getMissionList.php',dataType:'json',async:true,timeout:3000,success:function(data){displayMissionList(data,id)},error:function(){alert('Fail to get mission list!')}})}function displayMissionList(data,id){var selectNode=document.getElementById('missionSelection');var optionNode=document.createElement('option');deleteAllChildren(selectNode);optionNode.setAttribute('id','0');optionNode.appendChild(document.createTextNode('Choose a mission'));selectNode.appendChild(optionNode);if(id==0){handleMissionSelection(0);optionNode.selected=true}if(len==0){optionNode=document.createElement('option');optionNode.setAttribute('id','-1');optionNode.appendChild(document.createTextNode('You don\'t have any saved mision yet.'));selectNode.appendChild(optionNode)}else{for(var i=0,len=data.length;i<len;i+=1){optionNode=document.createElement('option');optionNode.setAttribute("id",data[i]['id']);optionNode.setAttribute("data_token",data[i]['id']);optionNode.appendChild(document.createTextNode(data[i]['id']+' - '+data[i]['name']));if(id==data[i]['id']){optionNode.selected=true}selectNode.appendChild(optionNode)}}}function handleMissionSelection(id_mission){if(id_mission>0){getMissionInfoFromDB(id_mission);getMissionPointFromDB(id_mission)}else{deleteAllChildren(document.getElementById('missionPresentation'))}if(id_mission>0){document.getElementById("deleteMissionButton").classList.remove('disabled');document.getElementById("editMissionButton").classList.remove('disabled');document.getElementById("saveMissionButton").classList.remove('hidden');document.getElementById("cancelMissionButton").classList.remove('hidden');document.getElementById('myConfig').style.display='inline'}if(id_mission<=0){document.getElementById("deleteMissionButton").classList.add('disabled');document.getElementById("editMissionButton").classList.add('disabled');document.getElementById("saveMissionButton").classList.add('hidden');document.getElementById("cancelMissionButton").classList.add('hidden');document.getElementById('myConfig').style.display='none'}}function getMissionInfoFromDB(id_mission){$.ajax({type:'POST',url:'php/getMissionInfoFromDB.php',data:{id_mission:id_mission},dataType:'json',async:true,timeout:3000,success:function(data){missionName=data[0]["name"];missionDescription=data[0]["description"];missionLastUse=data[0]['last_use'];cleanMissionInfo();displayMissionInfo()},error:function(){alert('Fail to get mission info!')}})}function displayMissionInfo(){var parentNode=document.getElementById('missionPresentation');var nameNode=document.createElement('h3'),descriptionNode=document.createElement('p');nameNode.appendChild(document.createTextNode(missionName));descriptionNode.appendChild(document.createTextNode(missionDescription));descriptionNode.setAttribute("id","descriptionNode");parentNode.appendChild(nameNode);parentNode.appendChild(descriptionNode);if(missionLastUse!=null){var lastUseNode=document.createElement('p');lastUseNode.appendChild(document.createTextNode('This mission has been loaded on ASPire for the last time on the '+missionLastUse));parentNode.appendChild(lastUseNode)}}function cleanMissionInfo(){var parentNode=document.getElementById('missionPresentation');deleteAllChildren(parentNode)}$('#missionInstructionLink').on('click',function(){$('#instructionModal').modal('show')});$('#closeInstructionButton').on('click',function(){$('#instructionModal').modal('hide')});$("#deleteMissionButton").on('click',showDeleteConfirmationModal);function showDeleteConfirmationModal(){$('#deleteConfirmationModal').modal('show')}$('#cancelDeleteButton').on('click',function(){$('#deleteConfirmationModal').modal('hide')});$('#confirmDeleteButton').on('click',deleteMission);function deleteMission(){var selectedMission=$('#missionSelection').children(':selected').attr('id');$.ajax({type:'POST',url:'php/deleteMissionFromDB.php',data:{id_mission:selectedMission},timeout:3000,success:function(data){alert(data);getMissionListFromDB(0)},error:function(){alert('Fail!')}});$('#deleteConfirmationModal').modal('hide')}$('#createMissionButton').on('click',function(){$('#createMissionModal').modal('show')});$('#cancelCreateButton').on('click',function(){$('#createMissionModal').modal('hide')});$('#confirmCreateButton').on('click',createMission);function createMission(){var nameF=$('#newMissionName').val(),descriptionF=$('#newMissionDescription').val();$.ajax({type:'POST',url:'php/insertMissionIntoDB.php',data:{name:nameF,decription:descriptionF},timeout:3000,success:function(data){alert(data);getMissionListFromDB(0)},error:function(){alert('Fail creating mission!')}});$('#createMissionModal').modal('hide')}$('#editMissionButton').on('click',function(){$('#editMissionModal').modal('show');$('#editMissionName').val(missionName);$('#editMissionDescription').val(missionDescription)});$('#cancelEditMissionButton').on('click',function(){$('#editMissionModal').modal('hide')});$('#confirmEditMissionButton').on('click',function(){$.ajax({type:'POST',url:'php/updateMissionInfo.php',data:{name:$('#editMissionName').val(),description:$('#editMissionDescription').val(),id_mission:id_mission},timeout:3000,success:function(data){alert(data);getMissionInfoFromDB(id_mission);getMissionListFromDB(id_mission);$('#editMissionModal').modal('hide')},error:function(){alert('Fail!')}})});$('#cancelMissionButton').on('click',function(){location.reload()});$('#saveMissionButton').on('click',saveMissionIntoDB);$('.convertGPSCoordinates').on('click',function(){if($(this).attr('id')=="convertGPSCoordinatesNewPoint"){$('#createPointModal').modal('hide');$('#confirmGPSConverterButton').addClass('gpsNewPoint')}if($(this).attr('id')=="convertGPSCoordinatesEditPoint"){$('#editPointModal').modal('hide');$('#confirmGPSConverterButton').addClass('gpsEditPoint')}$('#gpsConverterModal').modal('show')});$('#cancelGPSConverterButton').on('click',function(){$('#gpsConverterModal').modal('hide')});$('#confirmGPSConverterButton').on('click',function(){var latitude,longitude;latitude=parseFloat($('#degLatitude').val())+parseFloat($('#minLatitude').val())/60+parseFloat($('#secLatitude').val())/3600;longitude=parseFloat($('#degLongitude').val())+parseFloat($('#minLongitude').val())/60+parseFloat($('#secLongitude').val())/3600;if($(this).hasClass('gpsNewPoint')){$('#gpsConverterModal').modal('hide');$('#newPointLatitude').val(latitude);$('#newPointLongitude').val(longitude);$('#createPointModal').modal('show')}if($(this).hasClass('gpsEditPoint')){$('#editPointLatitude').val(latitude);$('#editPointLongitude').val(longitude);$('#gpsConverterModal').modal('hide');$('#editPointModal').modal('show')}});$('#loadMissionButton').on('click',function(){saveMissionIntoDB();loadMissionToBoat(id_mission)});function loadMissionToBoat(id_mission){$.ajax({type:'POST',url:'php/loadMissionToBoat.php',data:{id_mission:id_mission},async:true,timeout:3000,success:function(data){alert(data)},error:function(){alert('Fail to load mission on the ASPire DB!')}})}}());
